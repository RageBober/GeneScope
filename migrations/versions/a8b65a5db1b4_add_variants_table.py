"""Add variants table

Revision ID: a8b65a5db1b4
Revises: 01b33d143451
Create Date: 2025-11-28 12:26:42.203025

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = 'a8b65a5db1b4'
down_revision: Union[str, Sequence[str], None] = '01b33d143451'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('variants',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('chromosome', sa.String(length=10), nullable=False),
    sa.Column('position', sa.Integer(), nullable=False),
    sa.Column('ref', sa.String(length=500), nullable=False),
    sa.Column('alt', sa.String(length=500), nullable=False),
    sa.Column('variant_type', sa.String(length=20), nullable=False),
    sa.Column('quality', sa.Float(), nullable=True),
    sa.Column('filter_status', sa.String(length=50), nullable=False),
    sa.Column('genotype', sa.String(length=10), nullable=True),
    sa.Column('depth', sa.Integer(), nullable=True),
    sa.Column('allele_depth', sa.String(length=50), nullable=True),
    sa.Column('gene_symbol', sa.String(length=50), nullable=True),
    sa.Column('gene_id', sa.String(length=50), nullable=True),
    sa.Column('transcript_id', sa.String(length=50), nullable=True),
    sa.Column('consequence', sa.String(length=100), nullable=True),
    sa.Column('impact', sa.String(length=20), nullable=True),
    sa.Column('hgvs_c', sa.String(length=200), nullable=True),
    sa.Column('hgvs_p', sa.String(length=200), nullable=True),
    sa.Column('gnomad_af', sa.Float(), nullable=True),
    sa.Column('gnomad_af_popmax', sa.Float(), nullable=True),
    sa.Column('clinvar_id', sa.String(length=20), nullable=True),
    sa.Column('clinvar_significance', sa.String(length=100), nullable=True),
    sa.Column('clinvar_conditions', sa.Text(), nullable=True),
    sa.Column('cadd_score', sa.Float(), nullable=True),
    sa.Column('revel_score', sa.Float(), nullable=True),
    sa.Column('sift_pred', sa.String(length=20), nullable=True),
    sa.Column('polyphen_pred', sa.String(length=20), nullable=True),
    sa.Column('annotations', sa.JSON(), nullable=True),
    sa.Column('sample_id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['sample_id'], ['samples.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_variants_clinvar', 'variants', ['clinvar_significance'], unique=False)
    op.create_index(op.f('ix_variants_gene_symbol'), 'variants', ['gene_symbol'], unique=False)
    op.create_index('ix_variants_impact', 'variants', ['impact'], unique=False)
    op.create_index('ix_variants_location', 'variants', ['chromosome', 'position'], unique=False)
    op.create_index('ix_variants_sample_gene', 'variants', ['sample_id', 'gene_symbol'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index('ix_variants_sample_gene', table_name='variants')
    op.drop_index('ix_variants_location', table_name='variants')
    op.drop_index('ix_variants_impact', table_name='variants')
    op.drop_index(op.f('ix_variants_gene_symbol'), table_name='variants')
    op.drop_index('ix_variants_clinvar', table_name='variants')
    op.drop_table('variants')
    # ### end Alembic commands ###
